<!Doctype html>
<html>
<head>
	<meta charset utf="utf-8">
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8">
	</script>
</head>

<body>
	<script>
	// var data = {
	// 	"name" : "microfells",
	// 	"children" : [
	// 			{"name" : "bubble",
	// 			 "size" : parseInt("2")+2,
	// 			 "leader" : "name", 
	// 			  "members" : "name3"},
	// 	]
	// }

	// var diameter = 500,
	// 	format = d3.format(",d");

	// var bubble = d3.layout.pack()
	// 	.sort(null)
	// 	.size([diameter, diameter])
	// 	.padding(1.5);

	// var svg = d3.select("body").append("svg")
	// 	.attr("width", diameter)
	// 	.attr("height", diameter)
	// 	.attr("class", "bubble");

	// var node = svg.selectAll(".node")
	// 		.data(bubble.nodes(classes(data))
	// 		.filter(function(d) { return !d.children; }))
	// 	.enter().append("g")
	// 		.attr("class", "node")
	// 		.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });

	// node.append("title")
	// 	.text(function(d) { console.log(d); return d.members + format(d.value - 2) + " points" ; });

	// node.append("circle")
	// 	.attr("r", function(d) { return d.r; })
	// 	.style("fill", function(d) {return "rgb(150, 30, " + (d.value % 255) + ")"; })

	// node.append("text")
	// 	.attr("dy", ".3em")
	// 	.style("text-anchor", "middle")
	// 	.style("font-family", "sans-serif")
	// 	.text(function(d) { return d.className.substring(0, d.r / 3); })
	// 	.on("mouseover", function() {
	// 		// for changing color of circle
	// 		d3.select(this.parentNode).selectAll('circle')
	// 			.style("fill", function(d) {return "rgb(" + (255 - d.value % 255) + ", " + (255 - d.value % 255) + ", 150)"; }); 
	// 		// for changing text
	// 		d3.select(this).selectAll('text').remove();
	// 		d3.select(this)
	// 			.append("text")
	// 				.attr("dy", ".3em")
	// 				.style("text-anchor", "middle")
	// 				.text(function(d) { return d.members.substring(0, d.r / 3); });
	// 	});

	// /************************************/
	// // HOVERING

	// d3.selectAll('.node')
	// 	.on("mouseover", function() {
	// 		// for changing color of circle
	// 		d3.select(this).selectAll('circle')
	// 			.style("fill", function(d) {return "rgb(" + (255 - d.value % 255) + ", " + (255 - d.value % 255) + ", 150)"; }); 
	// 		// for changing text
	// 		d3.select(this).selectAll('text').remove();
	// 		d3.select(this)
	// 			.append("text")
	// 				.attr("dy", ".3em")
	// 				.style("text-anchor", "middle")
	// 				.style("font-family", "sans-serif")
	// 				.text(function(d) { return d.leader.substring(0, d.r / 3); });
	// 				// .text(function(d) { return d.members.substring(0, d.r / 3); });
	// 	})
	// 	.on("mouseout", function() {
	// 		// for changing color of circle
	// 		d3.select(this).selectAll('circle')
	// 			.style("fill", function(d) {return "rgb(150, 30, " + (d.value % 255) + ")"; }); 
	// 		// for changing text
	// 		d3.select(this).selectAll('text').remove();
	// 		d3.select(this)
	// 			.append("text")
	// 				.attr("dy", ".3em")
	// 				.style("text-anchor", "middle")
	// 				.style("font-family", "sans-serif")
	// 				.text(function(d) { return d.className.substring(0, d.r / 3); });
	// 	})




	/************************************/


// 	var selection = d3.selectAll( '.selected');

// 	var x_original = y_original = undefined;

// 	var drag = d3.behavior.drag()
// 	.on("drag", function( d, i) {

// 	    //console.log("selection: "+JSON.stringify(selection));
	    
// 	    if( selection[0].indexOf( this)==-1) {
// 	        selection.classed( "selected", false);
// 	        selection = d3.select( this);
// 	        selection.classed( "selected", true);
// 	    } 
	    
// 	    // backup original position
// 	    if (x_original == undefined && y_original == undefined) {
// 	        x_original = d.x;
// 	        y_original = d.y;
// 	    };
	    
// 	    // move the circle with the cursor
// 	    selection.attr("transform", function( d, i) {
// 	        d.x += d3.event.dx;
// 	        d.y += d3.event.dy;
// 	        return "translate(" + [ d.x,d.y ] + ")"
// 	    });
	    
// 	    // rearrange other circles
// 	    node.data(bubble.nodes(classes(data)));

// 	    // reappend dragged element as last 
// 	    // so that its stays on top
// 	    d3.select(this).attr("transform", function( d, i) {
// 	    	return "translate(" + [ d3.event.x,d3.event.y ] + ")"
// 	    });
// 	    this.parentNode.appendChild( this);
// 	    d3.event.sourceEvent.stopPropagation();
// 	});

// node.call( drag);

var diameter = 960,
    format = d3.format(",d"),
    color = d3.scale.category20c();

var bubble = d3.layout.pack()
    .sort(null)
    .size([diameter, diameter])
    .padding(1.5);

var svg = d3.select("body").append("svg")
    .attr("width", diameter)
    .attr("height", diameter)
    .attr("class", "bubble");


d3.json("bmorecrime.json", function(error, root) {
	
	// data = root[0];
	console.log(root);
	console.log("hello");

  var node = svg.selectAll(".node")
      .data(bubble.nodes((root)))
      // .filter(function(d) { return !d.children; }))
    .enter().append("g")
      .attr("class", "node")
      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });

  node.append("title")
      .text(function(d) { return d.className + ": " + format(d.value); });

  node.append("circle")
      .attr("r", function(d) { return d.r; })
      .style("fill", function(d) { return color(d.packageName); });

  node.append("text")
      .attr("dy", ".3em")
      .style("text-anchor", "middle")
      .text(function(d) { return d.className.substring(0, d.r / 3); });
});


// Returns a flattened hierarchy containing all leaf nodes under the root.
	function classes(root) {
		var classes = [];

		function recurse(name, node) {
			if (node.children) node.children.forEach(function(child) { recurse(node.name, child); });
			else classes.push({packageName: name, className: node.name, value: node.size, leader : node.leader, members : node.members});
		}

		recurse(null, root);
		return {children: classes};
	}

	d3.select(self.frameElement).style("height", diameter + "px");




</script>




</body>



</html>